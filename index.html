<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“Š InfoVault</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; color: #333; padding: 20px; }
h2 { text-align: center; margin-bottom: 25px; font-size: 2em; color: #2c3e50; }
.box { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.box h3 { margin-bottom: 15px; color: #34495e; }
.add-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
.add-row input, .add-row select { min-width: 120px; padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; }
.add-row button { cursor: pointer; background-color: #3498db; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; }
.add-row button:hover { background-color: #2980b9; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #3498db; color: #fff; }
tr:nth-child(even) { background: #f7f9fc; }
tr:hover { background: #e1ecf7; }
td input, td select { width:100%; padding:6px; border-radius:4px; border:1px solid #ccc; }
td a { color:#3498db; text-decoration:none; }
td a:hover { text-decoration:underline; }
</style>
</head>
<body>

<h2>ðŸ“Š InfoVault</h2>

<!-- Entry Type Selector -->
<div class="box">
  <h3>Select Entry Type</h3>
  <select id="entryType" onchange="changeType()">
    <option value="movie">Movie / Series</option>
    <option value="software">Software / Server</option>
    <option value="personality">Famous Personality</option>
  </select>
</div>

<!-- Add Entry -->
<div class="box">
  <h3>Add New Entry</h3>
  <div class="add-row" id="addRow"></div>
  <button onclick="save()">Add Entry</button>
</div>

<!-- Search -->
<div class="box">
  <h3>Search Database</h3>
  <input id="key" placeholder="ID / Name / Type / Genre / Country / Profession">
  <button onclick="search()">Search</button>

  <table>
    <thead id="tableHead"></thead>
    <tbody id="res"></tbody>
  </table>
</div>

<script>
var API = "https://script.google.com/macros/s/AKfycbxk590dH0JxF0tSbwLkA48oaM9hV-nimZxhcsTQxsLBwCVZPAZqk3KlXIGtX-mtdKiE-g/exec";
var currentType = "movie";

// Fields per type (removed Famous Personality from movie/software)
const fields = {
  movie: [
    {id:"name", placeholder:"Movie / Series Name"},
    {id:"genre", placeholder:"Genre", type:"datalist", options:["Action","Adventure","Drama","Comedy","Horror","Romance","Sci-Fi"]},
    {id:"country", placeholder:"Country", type:"datalist", options:["USA","UK","India","Japan","Korea","France"]},
    {id:"year", placeholder:"Release Year", type:"number"},
    {id:"link", placeholder:"Link (Trailer / IMDb / Streaming)"}
  ],
  software: [
    {id:"name", placeholder:"Software / Server Name"},
    {id:"version", placeholder:"Version"},
    {id:"link", placeholder:"Link (Documentation / Download)"}
  ],
  personality: [
    {id:"name", placeholder:"Name"},
    {id:"profession", placeholder:"Profession / Field"},
    {id:"country", placeholder:"Country"},
    {id:"link", placeholder:"Link (Wiki / Profile / Reference)"}
  ]
};

// Table headers (removed Famous Personality column)
const headers = {
  movie: ["ID","Name","Genre","Country","Year","Link","Action"],
  software: ["ID","Name","Version","Link","Action"],
  personality: ["ID","Name","Profession","Country","Link","Action"]
};

function changeType(){
  currentType = document.getElementById("entryType").value;
  var row = document.getElementById("addRow");
  row.innerHTML = "";
  fields[currentType].forEach(f=>{
    if(f.type==="datalist"){
      row.innerHTML += `<input list="${f.id}List" id="${f.id}" placeholder="${f.placeholder}">
        <datalist id="${f.id}List">${f.options.map(o=>`<option>${o}</option>`).join("")}</datalist>`;
    } else {
      row.innerHTML += `<input id="${f.id}" placeholder="${f.placeholder}" ${f.type==="number"?"type='number'":""}>`;
    }
  });
  renderTableHead();
}

function renderTableHead(){
  var th = document.getElementById("tableHead");
  th.innerHTML = "<tr>" + headers[currentType].map(h=>`<th>${h}</th>`).join("") + "</tr>";
}

function addOption(id){
  var val = prompt("Enter new option for " + id + ":");
  if(val){
    var list = document.getElementById(id+"List");
    var exists = Array.from(list.options).some(o=>o.value.toLowerCase() === val.toLowerCase());
    if(!exists){
      var option = document.createElement("option");
      option.value = val;
      list.appendChild(option);
      document.getElementById(id).value = val;
      alert(val + " added!");
    } else {
      alert(val + " already exists!");
      document.getElementById(id).value = val;
    }
  }
}

function save(){
  var data = {action:"add", id:Date.now(), type: currentType};
  fields[currentType].forEach(f=>{
    data[f.id] = document.getElementById(f.id).value;
  });
  if(currentType==="movie") data.sheet="Sheet1";
  else if(currentType==="software") data.sheet="Sheet2";
  else data.sheet="Sheet3";

  fetch(API,{method:"POST", body:JSON.stringify(data)})
  .then(r=>r.json())
  .then(res=>{if(res.status==="success"){ alert("Saved!"); clearInputs(); } else alert("Error: "+res.message);})
  .catch(err=>alert("Error: "+err));
}

function clearInputs(){ fields[currentType].forEach(f=>document.getElementById(f.id).value=""); }

function search(){
  var key = document.getElementById("key").value;
  fetch(API,{method:"POST", body:JSON.stringify({action:"search", key:key, sheet: currentType==="movie"?"Sheet1":currentType==="software"?"Sheet2":"Sheet3"})})
  .then(r=>r.json()).then(show).catch(err=>alert("Error: "+err));
}

function show(data){
  var res = document.getElementById("res");
  res.innerHTML = "";
  data.forEach(r=>{
    var row = "<tr>";
    headers[currentType].forEach((h,i)=>{
      if(h==="Link") row += `<td>${r[i]?'<a href="'+r[i]+'" target="_blank">Open Link</a>':''}</td>`;
      else if(h==="Action") row += `<td><button onclick="update('${r[0]}')">Update</button></td>`;
      else row += `<td><input value="${r[i]}"></td>`;
    });
    row += "</tr>";
    res.innerHTML += row;
  });
}

function update(id){
  var data = {action:"update", id:id};
  fields[currentType].forEach(f=>{
    var val = document.querySelector(`#res input[id^='${f.id}']`)?.value || document.getElementById(f.id)?.value;
    if(val) data[f.id] = val;
  });
  if(currentType==="movie") data.sheet="Sheet1";
  else if(currentType==="software") data.sheet="Sheet2";
  else data.sheet="Sheet3";

  fetch(API,{method:"POST", body:JSON.stringify(data)})
  .then(r=>r.json())
  .then(res=>{if(res.status==="success") alert("Updated!"); else alert("Update failed: "+res.message);})
  .catch(err=>alert("Error: "+err));
}

changeType();
</script>

</body>
</html>

